---
import Layout from '../layouts/Layout.astro'
import Nav from '../components/Nav.astro'
import Terminal from '../components/Terminal.astro'
import Button from '../components/Button.astro'
import FeatureCard from '../components/FeatureCard.astro'
import CodeBlock from '../components/CodeBlock.astro'
import WaveBackground from '../components/WaveBackground.astro'
import LeadCaptureSection from '../components/LeadCaptureSection.astro'
import { siteConfig } from '../config'

const terminalLines = [
  { text: '', type: 'output', delay: 600 },
  { text: '<span class="text-buoy">üõü</span> Scanning for design drift...', type: 'output', delay: 800 },
  { text: '', type: 'output', delay: 1200 },
  { text: 'Found <span class="text-warning">23</span> issues in <span class="text-slate">142 files</span>', type: 'output', delay: 1400 },
  { text: '', type: 'output', delay: 1600 },
  { text: '<span class="text-critical font-semibold">CRITICAL (2)</span>', type: 'output', delay: 1800 },
  { text: '‚îú‚îÄ Button.tsx:12 Missing aria-label', type: 'critical', delay: 2000 },
  { text: '‚îî‚îÄ Modal.tsx:45 Focus trap not implemented', type: 'critical', delay: 2200 },
  { text: '', type: 'output', delay: 2400 },
  { text: '<span class="text-warning font-semibold">HARDCODED VALUES (8)</span>', type: 'output', delay: 2600 },
  { text: '‚îú‚îÄ Card.tsx:8 #ffffff <span class="text-slate">‚Üí use var(--bg-surface)</span>', type: 'warning', delay: 2800 },
  { text: '‚îú‚îÄ Badge.tsx:3 8px <span class="text-slate">‚Üí use var(--spacing-sm)</span>', type: 'warning', delay: 3000 },
  { text: '‚îî‚îÄ <span class="text-slate-dark">... and 6 more</span>', type: 'muted', delay: 3200 },
  { text: '', type: 'output', delay: 3400 },
  { text: '<span class="text-buoy font-semibold">Add to CI to catch drift on every PR</span>', type: 'output', delay: 3600 },
]

const ciTerminalLines = [
  { text: '', type: 'output', delay: 600 },
  { text: '<span class="text-buoy">üõü</span> Buoy CI ‚Äî checking PR #247...', type: 'output', delay: 800 },
  { text: '', type: 'output', delay: 1200 },
  { text: '<span class="text-critical font-semibold">‚úó BLOCKED</span> ‚Äî 3 new drift issues found', type: 'critical', delay: 1400 },
  { text: '', type: 'output', delay: 1600 },
  { text: '‚îú‚îÄ src/components/Card.tsx:23', type: 'output', delay: 1800 },
  { text: '‚îÇ  <span class="text-warning">Hardcoded color #3b82f6</span>', type: 'warning', delay: 2000 },
  { text: '‚îÇ  <span class="text-slate">‚Üí use var(--color-primary)</span>', type: 'output', delay: 2200 },
  { text: '', type: 'output', delay: 2400 },
  { text: '‚îú‚îÄ src/components/Modal.tsx:8', type: 'output', delay: 2600 },
  { text: '‚îÇ  <span class="text-warning">Hardcoded spacing 24px</span>', type: 'warning', delay: 2800 },
  { text: '‚îÇ  <span class="text-slate">‚Üí use var(--spacing-lg)</span>', type: 'output', delay: 3000 },
  { text: '', type: 'output', delay: 3200 },
  { text: '<span class="text-slate">Fix these issues to merge this PR</span>', type: 'output', delay: 3400 },
]

const driftTypes = [
  {
    title: 'Hardcoded Values',
    severity: 'Warning',
    description: 'Colors, spacing, fonts not using tokens',
    icon: 'üé®',
    href: '/features/hardcoded-values'
  },
  {
    title: 'Duplicate Components',
    severity: 'Warning',
    description: 'Similar components that should be consolidated',
    icon: 'üì¶',
    href: '/features/duplicate-detection'
  },
  {
    title: 'Naming Inconsistency',
    severity: 'Info',
    description: 'Component/prop names that don\'t match conventions',
    icon: 'üè∑Ô∏è',
    href: '/features/naming-consistency'
  },
  {
    title: 'Deprecated Patterns',
    severity: 'Warning',
    description: 'Components marked @deprecated still in use',
    icon: '‚ö†Ô∏è',
  },
  {
    title: 'Inline Styles',
    severity: 'Warning',
    description: 'Inline CSS that should use tokens or classes',
    icon: 'üîß',
  },
  {
    title: 'Accessibility Conflict',
    severity: 'Critical',
    description: 'Missing ARIA labels, focus issues',
    icon: '‚ôø',
    href: '/features/accessibility-checks'
  },
  {
    title: 'Framework Sprawl',
    severity: 'Warning',
    description: 'Multiple UI frameworks in same codebase',
    icon: 'üåê',
    href: '/features/framework-sprawl'
  },
  {
    title: 'Orphaned Components',
    severity: 'Info',
    description: 'Components in code but not in design',
    icon: 'üëª',
  },
]

const integrations = [
  { name: 'React', icon: '‚öõÔ∏è', href: '/integrations/react' },
  { name: 'Vue', icon: 'üíö', href: '/integrations/vue' },
  { name: 'Svelte', icon: 'üî∂', href: '/integrations/svelte' },
  { name: 'Angular', icon: 'üî∫', href: '/integrations/angular' },
  { name: 'Next.js', icon: '‚ñ≤', href: '/integrations/nextjs' },
  { name: 'Tailwind', icon: 'üåä', href: '/integrations/tailwind' },
  { name: 'GitHub', icon: 'üêô', href: '/integrations/github' },
]

const steps = [
  {
    step: '1',
    title: 'Detect',
    command: 'buoy drift check',
    description: 'Zero config. Every issue with exact file and line.'
  },
  {
    step: '2',
    title: 'Enforce',
    command: 'buoy drift check',
    description: 'Catch drift at PR. Nothing bad reaches main.'
  },
  {
    step: '3',
    title: 'Measure',
    command: 'buoy show health',
    description: 'Track design system health over time.'
  },
]
---

<Layout title="Buoy - Design Drift Detection for the AI Era">
  <Nav />

  <!-- Hero Section -->
  <section class="relative min-h-screen flex items-center justify-center overflow-hidden">
    <!-- Digital wave background -->
    <WaveBackground />

    <!-- Wave boat ‚Äî lives outside wave-background so z-index can exceed the z-10 content div -->
    <div class="boat" id="waveBoat">‚õµ</div>

    <div class="relative z-10 hero-content max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-24 pb-16">
      <div class="text-center max-w-4xl mx-auto">
        <!-- Tagline badge -->
        <div class="inline-flex items-center px-4 py-2 rounded-full bg-navy/60 border border-navy-light/30 mb-8 backdrop-blur-sm">
          <span class="text-sm text-slate">The code control layer design has been missing</span>
        </div>

        <!-- Main headline -->
        <h1 class="text-4xl sm:text-5xl lg:text-6xl font-extrabold mb-6 leading-tight font-[Satoshi]">
          <span class="hero-reveal text-light" style="animation-delay: 0s">Catch</span>
          <span class="hero-reveal hero-drift-highlight" style="animation-delay: 0.22s">design drift</span>
          <br />
          <span class="hero-reveal text-light" style="animation-delay: 0.82s">before</span>
          <span class="hero-reveal text-light" style="animation-delay: 0.93s">it</span>
          <span class="hero-reveal text-light" style="animation-delay: 1.04s">ships.</span>
        </h1>

        <!-- Subheadline -->
        <p class="text-lg sm:text-xl text-slate max-w-2xl mx-auto mb-10" style="text-shadow: 0 1px 3px rgba(0,0,0,0.2)">
          Design systems drift over time. Buoy watches every PR for hardcoded colors, token violations, and rogue components.<span class="hero-boat-inline" id="heroBoatInline">&nbsp;<span class="hero-boat-emoji" id="heroBoatEmoji">‚õµ</span></span>
        </p>

        <!-- CTAs -->
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4 mb-12">
          <Button href="https://github.com/marketplace/buoy-design" size="lg" external>
            Try it now ‚Äî it's free
          </Button>
          <Button href={siteConfig.githubUrl} variant="secondary" size="lg" external>
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12c0 4.42 2.865 8.17 6.839 9.49.5.092.682-.217.682-.482 0-.237-.008-.866-.013-1.7-2.782.604-3.369-1.34-3.369-1.34-.454-1.156-1.11-1.464-1.11-1.464-.908-.62.069-.608.069-.608 1.003.07 1.531 1.03 1.531 1.03.892 1.529 2.341 1.087 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.11-4.555-4.943 0-1.091.39-1.984 1.029-2.683-.103-.253-.446-1.27.098-2.647 0 0 .84-.269 2.75 1.025A9.578 9.578 0 0112 6.836c.85.004 1.705.114 2.504.336 1.909-1.294 2.747-1.025 2.747-1.025.546 1.377.203 2.394.1 2.647.64.699 1.028 1.592 1.028 2.683 0 3.842-2.339 4.687-4.566 4.935.359.309.678.919.678 1.852 0 1.336-.012 2.415-.012 2.743 0 .267.18.578.688.48C19.138 20.167 22 16.418 22 12c0-5.523-4.477-10-10-10z"/>
            </svg>
            View on GitHub
          </Button>
        </div>

        <!-- Quick install command -->
        <div class="inline-flex items-center gap-3 px-4 py-3 bg-navy/80 border border-navy-light/30 rounded-lg font-mono text-sm backdrop-blur-sm copy-command" data-command="npx ahoybuoy dock">
          <span class="text-slate">$</span>
          <code class="text-light">npx ahoybuoy dock</code>
          <button class="copy-btn text-slate hover:text-buoy transition-colors" aria-label="Copy command">
            <svg class="copy-icon w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
            <svg class="check-icon w-4 h-4 hidden text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
          </button>
        </div>
        <p class="text-light-muted text-sm mt-4">
          Paste in your terminal or AI
        </p>
      </div>
    </div>

    <!-- Scroll indicator -->
    <div class="absolute bottom-8 left-1/2 -translate-x-1/2 animate-bounce">
      <svg class="w-6 h-6 text-light-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
      </svg>
    </div>
  </section>

  <!-- Wave divider -->
  <div class="relative h-24 bg-navy-dark -mt-1">
    <svg class="absolute top-0 left-0 w-full h-full" viewBox="0 0 1440 96" preserveAspectRatio="none">
      <path d="M0,0 Q360,96 720,48 T1440,96 L1440,96 L0,96 Z" fill="#0d1829"/>
    </svg>
  </div>

  <!-- Problem Statement Section -->
  <section class="py-24 bg-navy-dark relative -mt-24">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-3xl sm:text-4xl font-bold text-light mb-4">
          üíß Design systems leak.
        </h2>
        <p class="text-lg text-slate max-w-2xl mx-auto">
          Hardcoded values creep in. Drift compounds.
        </p>
      </div>

      <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
        <!-- What AI generates -->
        <div class="bg-navy/50 border border-critical/30 rounded-xl overflow-hidden">
          <div class="px-4 py-2 bg-critical/10 border-b border-critical/20 flex items-center justify-between">
            <span class="text-sm font-semibold text-critical uppercase tracking-wide">What AI generates</span>
            <span class="text-xs text-critical/70">Card.tsx</span>
          </div>
          <div class="p-4 font-mono text-sm">
            <pre class="text-slate-dark"><code><span class="text-slate">const Card = () =&gt; (</span>
  <span class="text-slate">&lt;div style=&#123;&#123;</span>
    <span class="text-critical">background: "#ffffff"</span><span class="text-slate-dark">,</span>
    <span class="text-critical">padding: "16px"</span><span class="text-slate-dark">,</span>
    <span class="text-critical">borderRadius: "8px"</span><span class="text-slate-dark">,</span>
    <span class="text-critical">boxShadow: "0 2px 4px rgba..."</span>
  <span class="text-slate">&#125;&#125;&gt;</span>
    <span class="text-slate">&#123;children&#125;</span>
  <span class="text-slate">&lt;/div&gt;</span>
<span class="text-slate">)</span></code></pre>
          </div>
        </div>

        <!-- What you want -->
        <div class="bg-navy/50 border border-success/30 rounded-xl overflow-hidden">
          <div class="px-4 py-2 bg-success/10 border-b border-success/20 flex items-center justify-between">
            <span class="text-sm font-semibold text-success uppercase tracking-wide">What you want</span>
            <span class="text-xs text-success/70">Card.tsx</span>
          </div>
          <div class="p-4 font-mono text-sm">
            <pre class="text-slate-dark"><code><span class="text-slate">import &#123; Card &#125; from "@/components"</span>

<span class="text-slate">const MyCard = () =&gt; (</span>
  <span class="text-success">&lt;Card variant="elevated"&gt;</span>
    <span class="text-slate">&#123;children&#125;</span>
  <span class="text-success">&lt;/Card&gt;</span>
<span class="text-slate">)</span>


</code></pre>
          </div>
        </div>
      </div>

      <!-- What Buoy catches -->
      <div class="mt-12 max-w-3xl mx-auto">
        <h3 class="text-2xl sm:text-3xl font-bold text-light mb-6 text-center">
          üõü  Buoy plugs the holes.
        </h3>
        <div class="bg-navy/30 border border-buoy/20 rounded-xl p-6">
          <div class="text-sm font-semibold text-buoy mb-4">
            What Buoy catches:
          </div>
          <div class="grid sm:grid-cols-3 gap-4 text-sm">
            <div class="flex items-start gap-2">
              <span class="text-warning mt-0.5">‚ö†</span>
              <div>
                <div class="text-light font-medium">Hardcoded colors</div>
                <div class="text-slate-dark">#ffffff ‚Üí var(--bg)</div>
              </div>
            </div>
            <div class="flex items-start gap-2">
              <span class="text-warning mt-0.5">‚ö†</span>
              <div>
                <div class="text-light font-medium">Magic numbers</div>
                <div class="text-slate-dark">16px ‚Üí var(--space-4)</div>
              </div>
            </div>
            <div class="flex items-start gap-2">
              <span class="text-warning mt-0.5">‚ö†</span>
              <div>
                <div class="text-light font-medium">Duplicate components</div>
                <div class="text-slate-dark">Use &lt;Card&gt; instead</div>
              </div>
            </div>
          </div>
        </div>
        <div class="mt-6 text-center">
          <a href="#features" class="text-buoy hover:text-buoy-light text-sm font-medium transition-colors">
            See all drift types ‚Üí
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Lead Capture Section -->
  <LeadCaptureSection />

  <!-- Terminal Demo Section: Find -->
  <section class="py-24 bg-navy relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-b from-navy-dark via-navy to-navy-dark"></div>

    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl sm:text-4xl font-bold text-light mb-4">
          Find drift in seconds
        </h2>
        <p class="text-lg text-slate">
          One command. Every issue with exact file, line, and suggestion.
        </p>
      </div>

      <Terminal
        command="buoy drift check"
        lines={terminalLines}
        class="max-w-3xl mx-auto"
      />
    </div>
  </section>

  <!-- CI Enforcement Section: GitHub PR Style -->
  <section class="py-24 bg-navy-dark relative overflow-hidden">
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl sm:text-4xl font-bold text-light mb-4">
          Catch drift at the PR
        </h2>
        <p class="text-lg text-slate">
          Install the Buoy GitHub App. Drift never reaches main.
        </p>
      </div>

      <!-- GitHub PR Check Style Card -->
      <div class="max-w-3xl mx-auto">
        <div class="bg-[#0d1117] border border-[#30363d] rounded-lg overflow-hidden shadow-xl">
          <!-- PR Header -->
          <div class="px-4 py-3 border-b border-[#30363d] flex items-center gap-3">
            <div class="flex items-center gap-2">
              <svg class="w-5 h-5 text-[#3fb950]" fill="currentColor" viewBox="0 0 16 16">
                <path d="M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z"/>
              </svg>
              <span class="text-[#c9d1d9] font-semibold">feat: add new Card component</span>
            </div>
            <span class="text-[#8b949e] text-sm">#247</span>
          </div>

          <!-- Checks Section -->
          <div class="px-4 py-3 border-b border-[#30363d]">
            <div class="flex items-center gap-2 mb-3">
              <svg class="w-4 h-4 text-[#f85149]" fill="currentColor" viewBox="0 0 16 16">
                <path d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"/>
              </svg>
              <span class="text-[#f85149] font-medium text-sm">Buoy Design Check ‚Äî 3 issues found</span>
            </div>
          </div>

          <!-- Annotations -->
          <div class="divide-y divide-[#30363d]">
            <!-- Annotation 1 -->
            <div class="px-4 py-3">
              <div class="flex items-start gap-3">
                <div class="mt-0.5">
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[#f8514926] text-[#f85149] border border-[#f8514940]">
                    error
                  </span>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <span class="text-[#58a6ff] text-sm font-mono hover:underline cursor-pointer">src/components/Card.tsx</span>
                    <span class="text-[#8b949e] text-sm">line 23</span>
                  </div>
                  <p class="text-[#c9d1d9] text-sm mb-1">Hardcoded color <code class="px-1.5 py-0.5 bg-[#161b22] rounded text-[#f85149] text-xs">#3b82f6</code></p>
                  <p class="text-[#8b949e] text-sm">Use <code class="px-1.5 py-0.5 bg-[#161b22] rounded text-[#7ee787] text-xs">var(--color-primary)</code> instead</p>
                </div>
              </div>
            </div>

            <!-- Annotation 2 -->
            <div class="px-4 py-3">
              <div class="flex items-start gap-3">
                <div class="mt-0.5">
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[#f8514926] text-[#f85149] border border-[#f8514940]">
                    error
                  </span>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <span class="text-[#58a6ff] text-sm font-mono hover:underline cursor-pointer">src/components/Card.tsx</span>
                    <span class="text-[#8b949e] text-sm">line 31</span>
                  </div>
                  <p class="text-[#c9d1d9] text-sm mb-1">Hardcoded spacing <code class="px-1.5 py-0.5 bg-[#161b22] rounded text-[#f85149] text-xs">24px</code></p>
                  <p class="text-[#8b949e] text-sm">Use <code class="px-1.5 py-0.5 bg-[#161b22] rounded text-[#7ee787] text-xs">var(--spacing-lg)</code> instead</p>
                </div>
              </div>
            </div>

            <!-- Annotation 3 -->
            <div class="px-4 py-3">
              <div class="flex items-start gap-3">
                <div class="mt-0.5">
                  <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-[#d29922] text-[#0d1117] border border-[#d2992240]">
                    warn
                  </span>
                </div>
                <div class="flex-1 min-w-0">
                  <div class="flex items-center gap-2 mb-1">
                    <span class="text-[#58a6ff] text-sm font-mono hover:underline cursor-pointer">src/components/Modal.tsx</span>
                    <span class="text-[#8b949e] text-sm">line 8</span>
                  </div>
                  <p class="text-[#c9d1d9] text-sm mb-1">Hardcoded border radius <code class="px-1.5 py-0.5 bg-[#161b22] rounded text-[#d29922] text-xs">8px</code></p>
                  <p class="text-[#8b949e] text-sm">Use <code class="px-1.5 py-0.5 bg-[#161b22] rounded text-[#7ee787] text-xs">var(--radius-md)</code> instead</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Footer -->
          <div class="px-4 py-3 bg-[#161b22] border-t border-[#30363d] flex items-center justify-between">
            <span class="text-[#8b949e] text-sm">Fix these issues to merge</span>
            <div class="flex items-center gap-2">
              <span class="text-[#8b949e] text-xs">Powered by</span>
              <span class="text-[#c9d1d9] text-sm font-semibold">üõü Buoy</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Free tier badge + CTA -->
      <div class="mt-10 max-w-2xl mx-auto text-center">
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-success/10 border border-success/30 mb-6">
          <span class="text-success">‚úì</span>
          <span class="text-sm text-success font-medium">Free for the first 100 teams ‚Äî 95 spots left</span>
        </div>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
          <Button href="https://github.com/marketplace/buoy-design" size="lg" external>
            Install GitHub App
          </Button>
        </div>
      </div>
    </div>
  </section>

  <!-- Feature Grid Section -->
  <section id="features" class="py-24 bg-navy-dark">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl sm:text-4xl font-bold text-light mb-4">
          What Buoy Detects
        </h2>
        <p class="text-lg text-slate max-w-2xl mx-auto">
          Categorized by severity to help you prioritize fixes
        </p>
      </div>

      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
        {driftTypes.map((drift) => {
          const severityColors = {
            Critical: 'border-critical/30 hover:border-critical/50',
            Warning: 'border-warning/30 hover:border-warning/50',
            Info: 'border-info/30 hover:border-info/50',
          }
          const severityBadge = {
            Critical: 'bg-critical/20 text-critical',
            Warning: 'bg-warning/20 text-warning',
            Info: 'bg-info/20 text-info',
          }

          return (
            <div class={`bg-navy/50 border ${severityColors[drift.severity]} rounded-xl p-5 transition-colors`}>
              <div class="flex items-start justify-between mb-3">
                <span class="text-2xl">{drift.icon}</span>
                <span class={`text-xs px-2 py-0.5 rounded-full ${severityBadge[drift.severity]}`}>
                  {drift.severity}
                </span>
              </div>
              <h3 class="font-semibold text-light mb-2">
                {drift.href ? (
                  <a href={drift.href} class="hover:text-buoy transition-colors">
                    {drift.title}
                  </a>
                ) : drift.title}
              </h3>
              <p class="text-sm text-slate">{drift.description}</p>
            </div>
          )
        })}
      </div>

      <div class="text-center mt-8">
        <a href="/features/drift-detection" class="text-buoy hover:underline text-sm">
          Read More ‚Üí
        </a>
      </div>
    </div>
  </section>

  <!-- How It Works Section -->
  <section class="py-24 bg-navy">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-3xl sm:text-4xl font-bold text-light mb-4">
          Detect. Enforce. Measure.
        </h2>
        <p class="text-lg text-slate">
          Find drift, catch it at CI, and track your progress.
        </p>
      </div>

      <div class="grid md:grid-cols-3 gap-8 max-w-4xl mx-auto">
        {steps.map((step) => (
          <div class="text-center">
            <div class="w-12 h-12 rounded-full bg-buoy/20 border-2 border-buoy text-buoy font-bold flex items-center justify-center mx-auto mb-4 text-xl">
              {step.step}
            </div>
            <h3 class="text-xl font-semibold text-light mb-2">{step.title}</h3>
            <code class="text-sm text-buoy bg-navy-dark px-3 py-1 rounded-md font-mono inline-block mb-3">
              $ {step.command}
            </code>
            <p class="text-slate text-sm">{step.description}</p>
          </div>
        ))}
      </div>

      <div class="text-center mt-12">
        <Button href="/docs" variant="secondary">
          See full documentation ‚Üí
        </Button>
      </div>
    </div>
  </section>

  <!-- Integrations Section -->
  <section class="py-24 bg-navy-dark">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <h2 class="text-3xl sm:text-4xl font-bold text-light mb-4">
          Works with your stack
        </h2>
      </div>

      <div class="flex flex-wrap justify-center gap-4 max-w-3xl mx-auto">
        {integrations.map((integration) => (
          <a href={integration.href} class="flex items-center gap-2 px-4 py-2 bg-navy/50 border border-navy-light/20 rounded-lg hover:border-buoy/30 hover:bg-navy/70 transition-colors">
            <span class="text-xl">{integration.icon}</span>
            <span class="text-sm text-slate">{integration.name}</span>
          </a>
        ))}
      </div>
    </div>
  </section>

  <!-- Journey Section: Start Free ‚Üí PR Comments ‚Üí Dashboard -->
  <section class="py-24 bg-navy">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-16">
        <h2 class="text-3xl sm:text-4xl font-bold text-light mb-4">
          Start free, scale when ready
        </h2>
        <p class="text-lg text-slate">
          Your journey from first scan to team-wide enforcement
        </p>
      </div>

      <div class="max-w-5xl mx-auto">
        <div class="grid md:grid-cols-3 gap-6">
          <!-- Step 1: Start Free -->
          <div class="relative bg-navy-dark border border-navy-light/30 rounded-xl p-6 hover:border-buoy/30 transition-colors">
            <div class="absolute -top-3 left-6">
              <span class="inline-flex items-center px-3 py-1 rounded-full bg-success/20 border border-success/30 text-xs font-semibold text-success">
                FREE
              </span>
            </div>
            <div class="pt-4">
              <div class="text-4xl mb-4">üîç</div>
              <h3 class="text-xl font-semibold text-light mb-2">Detect Locally</h3>
              <p class="text-slate text-sm mb-4">
                Run <code class="text-buoy">buoy drift check</code> in any project. See every hardcoded value, naming issue, and token violation.
              </p>
              <ul class="space-y-2 text-sm text-slate-dark">
                <li class="flex items-center gap-2">
                  <span class="text-success">‚úì</span> Unlimited scans
                </li>
                <li class="flex items-center gap-2">
                  <span class="text-success">‚úì</span> All detection rules
                </li>
                <li class="flex items-center gap-2">
                  <span class="text-success">‚úì</span> Fix suggestions
                </li>
              </ul>
            </div>
          </div>

          <!-- Step 2: PR Comments -->
          <div class="relative bg-navy-dark border border-navy-light/30 rounded-xl p-6 hover:border-buoy/30 transition-colors">
            <div class="absolute -top-3 left-6">
              <span class="inline-flex items-center px-3 py-1 rounded-full bg-buoy/20 border border-buoy/30 text-xs font-semibold text-buoy">
                GITHUB APP
              </span>
            </div>
            <div class="pt-4">
              <div class="text-4xl mb-4">üö¶</div>
              <h3 class="text-xl font-semibold text-light mb-2">Catch at PR</h3>
              <p class="text-slate text-sm mb-4">
                Install the Buoy GitHub App. Every PR gets checked. Drift blocked before merge.
              </p>
              <ul class="space-y-2 text-sm text-slate-dark">
                <li class="flex items-center gap-2">
                  <span class="text-success">‚úì</span> Inline PR comments
                </li>
                <li class="flex items-center gap-2">
                  <span class="text-success">‚úì</span> Check status integration
                </li>
                <li class="flex items-center gap-2">
                  <span class="text-success">‚úì</span> Auto-fix suggestions
                </li>
              </ul>
            </div>
          </div>

          <!-- Step 3: Team Dashboard -->
          <div class="relative bg-navy-dark border border-navy-light/30 rounded-xl p-6 hover:border-lavender/30 transition-colors">
            <div class="absolute -top-3 left-6">
              <span class="inline-flex items-center px-3 py-1 rounded-full bg-lavender/20 border border-lavender/30 text-xs font-semibold text-lavender">
                PRO
              </span>
            </div>
            <div class="pt-4">
              <div class="text-4xl mb-4">üìä</div>
              <h3 class="text-xl font-semibold text-light mb-2">Track Progress</h3>
              <p class="text-slate text-sm mb-4">
                Health scores, trend charts, team leaderboards. Prove ROI to stakeholders.
              </p>
              <ul class="space-y-2 text-sm text-slate-dark">
                <li class="flex items-center gap-2">
                  <span class="text-lavender">+</span> Private repo support
                </li>
                <li class="flex items-center gap-2">
                  <span class="text-lavender">+</span> Team dashboard
                </li>
                <li class="flex items-center gap-2">
                  <span class="text-lavender">+</span> Historical trends
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Journey arrows (mobile: vertical, desktop: horizontal) -->
        <div class="flex justify-center mt-8 gap-4">
          <div class="text-slate-dark text-sm">
            <span class="text-success">CLI (free)</span> ‚Üí <span class="text-buoy">GitHub App</span> ‚Üí <span class="text-lavender">Pro</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- AI Setup Section -->
  <section class="py-16 bg-navy-dark">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="max-w-2xl mx-auto text-center">
        <h2 class="text-2xl sm:text-3xl font-bold text-light mb-6">
          Using an AI coding assistant?
        </h2>
        <div class="bg-navy border border-lavender/30 rounded-xl p-5">
          <div class="text-sm text-lavender mb-3">Ask your AI to run:</div>
          <div class="bg-navy-dark/80 rounded-lg p-4 font-mono text-light text-sm sm:text-base">
            npx ahoybuoy dock
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- AI-Free Section -->
  <section class="py-24 bg-navy-dark">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="text-center mb-12">
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-success/10 border border-success/30 mb-6">
          <span class="text-success">üîí</span>
          <span class="text-sm text-success font-medium">Works without AI</span>
        </div>
        <h2 class="text-3xl sm:text-4xl font-bold text-light mb-4">
          AI is optional. Scanning isn't.
        </h2>
        <p class="text-lg text-slate max-w-2xl mx-auto">
          Core drift detection is 100% deterministic. No LLMs, no API keys, no data leaves your machine.
          Perfect for teams where AI tools are restricted.
        </p>
      </div>

      <div class="grid md:grid-cols-2 gap-8 max-w-4xl mx-auto">
        <!-- Buoy Scanner (Open Source) -->
        <div class="bg-navy-dark border border-success/30 rounded-xl p-6">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-lg bg-success/20 flex items-center justify-center">
              <span class="text-success text-xl">üîí</span>
            </div>
            <div>
              <h3 class="font-semibold text-light">Buoy Core</h3>
              <span class="text-xs text-success">Open Source CLI</span>
            </div>
          </div>
          <ul class="space-y-3 text-sm">
            <li class="flex items-start gap-2">
              <span class="text-success mt-0.5">‚úì</span>
              <span class="text-slate">All scanning & drift detection</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-success mt-0.5">‚úì</span>
              <span class="text-slate">Fix suggestions with exact token replacements</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-success mt-0.5">‚úì</span>
              <span class="text-slate">100% deterministic ‚Äî no LLMs</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-success mt-0.5">‚úì</span>
              <span class="text-slate">No data leaves your machine</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-success mt-0.5">‚úì</span>
              <span class="text-slate">Works air-gapped & offline</span>
            </li>
          </ul>
          <div class="mt-6 pt-4 border-t border-navy-light/20">
            <span class="text-xs text-slate-dark">No API keys required. No external calls. MIT licensed.</span>
          </div>
        </div>

        <!-- Buoy GitHub App -->
        <div class="bg-navy-dark border border-lavender/30 rounded-xl p-6">
          <div class="flex items-center gap-3 mb-4">
            <div class="w-10 h-10 rounded-lg bg-lavender/20 flex items-center justify-center">
              <span class="text-lavender text-xl">‚ú®</span>
            </div>
            <div>
              <h3 class="font-semibold text-light">Buoy Pro</h3>
              <span class="text-xs text-lavender">Core + AI</span>
            </div>
          </div>
          <ul class="space-y-3 text-sm">
            <li class="flex items-start gap-2">
              <span class="text-lavender mt-0.5">+</span>
              <span class="text-slate">Runs the same open-source scanner on every PR</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-lavender mt-0.5">+</span>
              <span class="text-slate">AI-powered PR summaries & coaching</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-lavender mt-0.5">+</span>
              <span class="text-slate">Committable inline fix suggestions</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-lavender mt-0.5">+</span>
              <span class="text-slate">Dashboard with health scores & trends</span>
            </li>
            <li class="flex items-start gap-2">
              <span class="text-lavender mt-0.5">+</span>
              <span class="text-slate">Builder mode coaching for new design systems</span>
            </li>
          </ul>
          <div class="mt-6 pt-4 border-t border-navy-light/20">
            <span class="text-xs text-slate-dark">AI built-in, no API key needed.</span>
          </div>
        </div>
      </div>

      <div class="text-center mt-8">
        <p class="text-sm text-slate">
          Start with Core. Add AI when you're ready. <a href="/features/ci" class="text-buoy hover:underline">Learn more ‚Üí</a>
        </p>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="border-t border-navy-light/20 bg-navy-dark">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex flex-col md:flex-row justify-between items-center gap-4 text-sm">
      <!-- Brand + Copyright -->
      <div class="flex items-center gap-2">
        <span class="text-lg">üõü</span>
        <span class="text-slate">&copy; {new Date().getFullYear()} Buoy. Scanner is open source under MIT.</span>
      </div>

      <!-- Links -->
      <div class="flex items-center gap-6">
        <a href={siteConfig.githubUrl} target="_blank" rel="noopener noreferrer" class="text-slate hover:text-light transition-colors">GitHub</a>
        <a href={siteConfig.twitterUrl} target="_blank" rel="noopener noreferrer" class="text-slate hover:text-light transition-colors">Twitter</a>
        <a href={siteConfig.discordUrl} target="_blank" rel="noopener noreferrer" class="text-slate hover:text-light transition-colors">Discord</a>
        <span class="text-navy-light">|</span>
        <a href="/privacy" class="text-slate hover:text-light transition-colors">Privacy</a>
        <a href="/terms" class="text-slate hover:text-light transition-colors">Terms</a>
        <a href="/support" class="text-slate hover:text-light transition-colors">Support</a>
      </div>
    </div>
  </footer>
</Layout>

<style>
  /* Wave boat ‚Äî positioned in hero section above z-10 content */
  .boat {
    position: absolute;
    bottom: 42%;
    left: 15%;
    font-size: 1.4rem;
    opacity: 0;
    z-index: 5;
    pointer-events: none;
    touch-action: none;
  }

  .boat::before {
    content: '';
    position: absolute;
    inset: -14px;
    touch-action: none;
  }

  .boat.launching {
    opacity: 1;
    animation: boatBob 4s ease-in-out infinite;
  }

  .boat.visible {
    opacity: 1;
    animation: boatBob 4s ease-in-out infinite, boatDrift 25s linear infinite;
  }

  @keyframes boatBob {
    0%, 100% { transform: translateY(0) rotate(0deg); }
    50% { transform: translateY(-15px) rotate(3deg); }
  }

  @keyframes boatDrift {
    0% { left: -5%; }
    100% { left: 105%; }
  }

  /* Hero content passes pointer events through to boat underneath,
     but restores them on interactive elements */
  .hero-content {
    pointer-events: none;
  }
  .hero-content a,
  .hero-content button,
  .hero-content [role="button"] {
    pointer-events: auto;
  }

  /* Hero boat inline at end of text */
  .hero-boat-inline {
    display: inline-block;
    position: relative;
    z-index: 20;
    white-space: nowrap;
  }

  .hero-boat-emoji {
    display: inline-block;
    font-size: 1.1em;
    cursor: default;
  }

  /* Splash droplet + ripple styles (created dynamically by JS) */
  @keyframes splashDroplet {
    0% {
      transform: translate(0, 0) scale(1);
      opacity: 0.8;
    }
    100% {
      transform: translate(var(--dx), var(--dy)) scale(0.2);
      opacity: 0;
    }
  }

  @keyframes splashRing {
    0% {
      transform: translate(-50%, -50%) scale(0.5);
      opacity: 0.6;
    }
    100% {
      transform: translate(-50%, -50%) scale(4, 2);
      opacity: 0;
    }
  }

  /* Reduced motion: skip animation, show wave boat directly */
  @media (prefers-reduced-motion: reduce) {
    .hero-boat-inline {
      display: none !important;
    }
  }
</style>

<script>
  // Hero boat escape animation ‚Äî boat wiggles free from text, drops into the waves
  function initHeroBoatAnimation() {
    const boatInline = document.getElementById('heroBoatInline');
    const boatEmoji = document.getElementById('heroBoatEmoji');
    const waveBoat = document.getElementById('waveBoat');

    if (!boatInline || !boatEmoji) return;

    // Reduced motion: just show the wave boat
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      if (waveBoat) waveBoat.classList.add('visible');
      return;
    }

    // Phase 1: Wiggle (anticipation ‚Äî building tension before the break)
    setTimeout(() => {
      const wiggle = boatEmoji.animate([
        { transform: 'rotate(0deg)', offset: 0 },
        { transform: 'rotate(8deg) translateX(1px)', offset: 0.15 },
        { transform: 'rotate(-7deg) translateX(-1px)', offset: 0.30 },
        { transform: 'rotate(12deg) translateX(2px) translateY(-2px)', offset: 0.50 },
        { transform: 'rotate(-10deg) translateX(-2px)', offset: 0.65 },
        { transform: 'rotate(5deg) translateX(1px)', offset: 0.80 },
        { transform: 'rotate(-2deg)', offset: 0.92 },
        { transform: 'rotate(0deg)', offset: 1 },
      ], { duration: 600, easing: 'ease-in-out' });

      wiggle.finished.then(() => {
        // Phase 2a: Anticipation ‚Äî slight lift before the drop
        boatInline.style.transition = 'transform 120ms ease-out';
        requestAnimationFrame(() => {
          boatInline.style.transform = 'translateY(-6px)';
        });

        // Phase 2b: Drop with gravity + soft bounce
        setTimeout(() => {
          boatInline.style.transition = 'transform 500ms cubic-bezier(0.4, 0, 0.68, 1.4)';
          const isMobile = window.innerWidth < 768;
          boatInline.style.transform = `translateY(${isMobile ? 30 : 37}px)`;
        }, 130);

        // Splash at impact (~60% of 500ms drop = 300ms after drop starts)
        setTimeout(() => {
          const landedRect = boatEmoji.getBoundingClientRect();
          createSplash(
            landedRect.left + landedRect.width / 2,
            landedRect.top + landedRect.height * 0.7 + 6
          );
        }, 500);

        // Handoff: overlap swap ‚Äî show wave boat first, hide inline next frame
        setTimeout(() => {
          if (waveBoat) {
            const emojiRect = boatEmoji.getBoundingClientRect();
            const waveParent = waveBoat.offsetParent || waveBoat.parentElement;
            const parentRect = waveParent.getBoundingClientRect();

            // Match position ‚Äî compensate for inline vs wave boat size difference
            const bottomPx = parentRect.bottom - emojiRect.bottom - 4;
            waveBoat.style.bottom = bottomPx + 'px';
            // Store so toss landing can match drop landing on all screen sizes
            window._buoyBoatBottom = bottomPx;

            const landedLeftPct = ((emojiRect.left + 4) / window.innerWidth) * 100;

            // Phase: Launch with ease-in (slow ‚Üí fast) before steady cruise
            waveBoat.style.left = landedLeftPct + '%';
            waveBoat.classList.add('launching');

            // Hide inline boat on next frame ‚Äî zero gap
            requestAnimationFrame(() => {
              boatInline.style.visibility = 'hidden';
            });

            // Ease-in launch: boat gently accelerates from rest to cruise speed
            // Cruise speed = 110% / 25s = 4.4%/s
            // Launch: 13% over 3s = 4.33%/s average, ending at ~4.4%/s
            const launchDuration = 3000;
            const launchDistance = 13;
            const endLeftPct = landedLeftPct + launchDistance;

            const launchAnim = waveBoat.animate([
              { left: landedLeftPct + '%' },
              { left: endLeftPct + '%' }
            ], {
              duration: launchDuration,
              easing: 'cubic-bezier(0.3, 0, 0.8, 0.8)', // starts at rest, ends at cruise speed
              fill: 'forwards'
            });

            launchAnim.finished.then(() => {
              launchAnim.cancel();

              // Switch to steady drift ‚Äî sync position
              waveBoat.style.left = '';
              waveBoat.classList.remove('launching');
              waveBoat.classList.add('visible');

              const driftProgress = (endLeftPct + 5) / 110;
              const driftDelay = -(driftProgress * 25);
              waveBoat.style.animationDelay = `0s, ${driftDelay}s`;
            });
          } else {
            boatInline.style.visibility = 'hidden';
          }
        }, 750);
      });
    }, 850);
  }

  function createSplash(x, y) {
    const waveBg = document.querySelector('.wave-background');
    if (!waveBg) return;
    const bgRect = waveBg.getBoundingClientRect();

    const container = document.createElement('div');
    Object.assign(container.style, {
      position: 'absolute',
      left: (x - bgRect.left) + 'px',
      top: (y - bgRect.top) + 'px',
      zIndex: '1',
      pointerEvents: 'none',
    });

    // Water droplets shooting upward in a fan
    const isLight = document.documentElement.classList.contains('light');
    for (let i = 0; i < 10; i++) {
      const drop = document.createElement('div');
      const angle = (-150 + (120 * i / 9)) * (Math.PI / 180);
      const speed = 18 + Math.random() * 28;
      const dx = Math.cos(angle) * speed;
      const dy = Math.sin(angle) * speed;
      const size = 3 + Math.random() * 4;
      const alpha = (0.65 + Math.random() * 0.3).toFixed(2);
      const dropColor = isLight
        ? `rgba(255, 255, 255, ${alpha})`
        : `rgba(${60 + Math.random() * 60 | 0}, ${140 + Math.random() * 60 | 0}, 255, ${(0.5 + Math.random() * 0.3).toFixed(2)})`;

      Object.assign(drop.style, {
        position: 'absolute',
        width: size + 'px',
        height: size + 'px',
        borderRadius: '50%',
        background: dropColor,
        left: '-2px',
        top: '-2px',
      });
      drop.style.setProperty('--dx', dx + 'px');
      drop.style.setProperty('--dy', dy + 'px');
      drop.style.animation = `splashDroplet ${(0.4 + Math.random() * 0.3).toFixed(2)}s ease-out ${(Math.random() * 0.08).toFixed(3)}s forwards`;
      container.appendChild(drop);
    }

    // Ripple ring on the water surface
    const isLight2 = document.documentElement.classList.contains('light');
    const ring = document.createElement('div');
    Object.assign(ring.style, {
      position: 'absolute',
      width: '20px',
      height: '8px',
      border: isLight2 ? '2px solid rgba(255, 255, 255, 0.75)' : '2px solid rgba(100, 180, 255, 0.5)',
      borderRadius: '50%',
      left: '0',
      top: '0',
      animation: 'splashRing 0.7s ease-out forwards',
    });
    container.appendChild(ring);


    waveBg.appendChild(container);
    setTimeout(() => container.remove(), 1200);
  }

  initHeroBoatAnimation();
  // Expose splash so drag script can call it
  window._buoySplash = createSplash;
</script>

<script>
  // Boat drag + gravity physics
  function initBoatDrag() {
    const boat = document.getElementById('waveBoat');
    const waveBg = document.querySelector('.wave-background');
    if (!boat || !waveBg) return;

    const GRAVITY = 0.4;
    let dragging = false;
    let physicsActive = false;
    let physicsRaf = null;
    let vx = 0, vy = 0;
    let posHistory = [];

    // Enable pointer events once boat becomes active
    const observer = new MutationObserver(() => {
      if (boat.classList.contains('visible') || boat.classList.contains('launching')) {
        boat.style.pointerEvents = 'auto';
        boat.style.cursor = 'grab';
      }
    });
    observer.observe(boat, { attributes: true, attributeFilter: ['class'] });

    let _cachedWaveY = null;
    window.addEventListener('resize', () => { _cachedWaveY = null; }, { passive: true });

    function getWaveY() {
      if (_cachedWaveY !== null) return _cachedWaveY;
      const wave3 = document.querySelector('.wave-container-3');
      if (!wave3) return waveBg.getBoundingClientRect().height * 0.62;
      const r = wave3.getBoundingClientRect();
      const bg = waveBg.getBoundingClientRect();
      _cachedWaveY = (r.top + (500 / 800) * r.height) - bg.top;
      return _cachedWaveY;
    }

    function lockPosition() {
      // Capture position BEFORE stopping animations
      const rect = boat.getBoundingClientRect();
      const parentRect = waveBg.getBoundingClientRect();
      const x = rect.left - parentRect.left;
      const y = rect.top - parentRect.top;
      // Remove classes to stop CSS animations cleanly (no inline animation:none hack)
      boat.classList.remove('visible', 'launching');
      boat.getAnimations().forEach(a => a.cancel());
      boat.style.animationDelay = '';
      boat.style.opacity = '1'; // base .boat has opacity:0, keep it visible during drag
      boat.style.left = x + 'px';
      boat.style.top = y + 'px';
      boat.style.bottom = 'auto';
      boat.style.transform = '';
      return { x, y };
    }

    boat.addEventListener('pointerdown', (e) => {
      if (!boat.classList.contains('visible') && !boat.classList.contains('launching')) return;
      e.preventDefault();
      document.body.style.userSelect = 'none'; // prevent text selection triggering pointercancel
      if (physicsActive) { cancelAnimationFrame(physicsRaf); physicsActive = false; }
      lockPosition();
      dragging = true;
      vx = 0; vy = 0;
      posHistory = [];
      boat.style.cursor = 'grabbing';
      try { boat.setPointerCapture(e.pointerId); } catch(err) {}
    });

    boat.addEventListener('pointermove', (e) => {
      if (!dragging) return;
      const bg = waveBg.getBoundingClientRect();
      const x = e.clientX - bg.left - boat.offsetWidth / 2;
      const y = e.clientY - bg.top - boat.offsetHeight / 2;
      boat.style.left = x + 'px';
      boat.style.top = y + 'px';

      posHistory.push({ x: e.clientX, y: e.clientY, t: Date.now() });
      if (posHistory.length > 6) posHistory.shift();

      if (posHistory.length >= 2) {
        const a = posHistory[posHistory.length - 2];
        const b = posHistory[posHistory.length - 1];
        boat.style.transform = `rotate(${Math.max(-25, Math.min(25, (b.x - a.x) * 2))}deg)`;
      }
    });

    function handleRelease() {
      if (!dragging) return;
      dragging = false;
      document.body.style.userSelect = '';
      boat.style.cursor = 'grab';

      const velScale = window.innerWidth < 768 ? 1.25 : 0.5;
      if (posHistory.length >= 2) {
        const newest = posHistory[posHistory.length - 1];
        const oldest = posHistory[0];
        const dt = Math.max(16, newest.t - oldest.t) / 1000;
        vx = (newest.x - oldest.x) / dt * 0.016 * velScale;
        vy = (newest.y - oldest.y) / dt * 0.016 * velScale;
      } else {
        vx = 0; vy = 0;
      }

      physicsActive = true;
      runFall();
    }

    boat.addEventListener('pointerup', handleRelease);
    // pointercancel fires instead of pointerup when pointer moves over selectable text,
    // which breaks capture and leaves the boat stuck ‚Äî treat it the same as release
    boat.addEventListener('pointercancel', handleRelease);

    function bobberPop(startX, startY) {
      const bgRect = waveBg.getBoundingClientRect();
      const waveY = getWaveY();
      const targetBottom = window._buoyBoatBottom ?? (bgRect.height - waveY - 8);
      const surfaceY = bgRect.height - targetBottom - boat.offsetHeight;

      // Straight-up spring ‚Äî pops directly to surface with single overshoot bounce
      const popAnim = boat.animate([
        { top: startY + 'px' },
        { top: surfaceY + 'px' }
      ], {
        duration: 650,
        easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.55)',
        fill: 'forwards'
      });

      // Splash when boat first breaks the surface (~45% through)
      setTimeout(() => {
        if (window._buoySplash) {
          window._buoySplash(bgRect.left + startX + boat.offsetWidth / 2, bgRect.top + bgRect.height - targetBottom - Math.round(boat.offsetHeight * 0.25) + 2);
        }
      }, 295);

      popAnim.finished.then(() => {
        boat.style.top = surfaceY + 'px';
        popAnim.cancel();
        setTimeout(() => resumeDrift(startX), 100);
      });
    }

    function runFall() {
      let x = parseFloat(boat.style.left);
      let y = parseFloat(boat.style.top);

      // Released below the wave ‚Äî pop up like a bobber instead of falling
      const bgRectInit = waveBg.getBoundingClientRect();
      if (y + boat.offsetHeight > getWaveY() + 8) {
        physicsActive = false;
        bobberPop(x, y);
        return;
      }

      function step() {
        if (!physicsActive) return;

        // Gravity
        vy += GRAVITY;
        vx *= 0.99;

        x += vx;
        y += vy;

        const bgRect = waveBg.getBoundingClientRect();
        const waveY = getWaveY();

        // Tilt based on horizontal movement
        boat.style.transform = `rotate(${Math.max(-20, Math.min(20, vx * 1.5))}deg)`;

        // Loop off the bottom ‚Üí reappear at top
        if (y > bgRect.height + boat.offsetHeight) {
          y = -boat.offsetHeight;
          vy = Math.min(vy, 8); // cap reentry speed
        }

        // Wrap horizontal first so landing always happens at an on-screen x
        if (x > bgRect.width) x = -boat.offsetWidth;
        else if (x < -boat.offsetWidth) x = bgRect.width;

        // Hit the wave surface (only when falling downward)
        const landingBottom = window._buoyBoatBottom ?? (bgRect.height - waveY - 8);
        const landingY = bgRect.height - landingBottom - boat.offsetHeight;
        const boatBottom = y + boat.offsetHeight;
        if (boatBottom >= bgRect.height - landingBottom && vy > 0) {
          physicsActive = false;
          y = landingY;
          boat.style.left = x + 'px';
          boat.style.top = y + 'px';
          boat.style.transform = '';

          // Splash at impact
          if (window._buoySplash) {
            window._buoySplash(
              bgRect.left + x + boat.offsetWidth / 2,
              bgRect.top + bgRect.height - landingBottom - Math.round(boat.offsetHeight * 0.25) + 2
            );
          }

          // Brief pause then resume drift
          setTimeout(() => resumeDrift(x), 150);
          return;
        }
        boat.style.left = x + 'px';
        boat.style.top = y + 'px';

        physicsRaf = requestAnimationFrame(step);
      }

      physicsRaf = requestAnimationFrame(step);
    }

    function resumeDrift(currentX) {
      const bgRect = waveBg.getBoundingClientRect();
      const waveY = getWaveY();
      const landedLeftPct = (currentX / bgRect.width) * 100;

      // Position at landing spot
      boat.style.left = landedLeftPct + '%';
      boat.style.top = '';
      boat.style.transform = '';
      boat.style.animationDelay = '';
      boat.style.opacity = '1';
      boat.style.bottom = (window._buoyBoatBottom ?? (bgRect.height - waveY - 8)) + 'px';

      // Bob only (no drift) while easing in
      boat.classList.add('launching');

      // Ease-in to cruise speed ‚Äî mirrors the initial hero handoff animation
      const launchDistance = 13;
      const endLeftPct = landedLeftPct + launchDistance;

      const launchAnim = boat.animate([
        { left: landedLeftPct + '%' },
        { left: endLeftPct + '%' }
      ], {
        duration: 3000,
        easing: 'cubic-bezier(0.3, 0, 0.8, 0.8)',
        fill: 'forwards'
      });

      launchAnim.finished.then(() => {
        launchAnim.cancel();
        boat.style.left = '';
        boat.classList.remove('launching');
        boat.classList.add('visible');

        // Seek drift to exact position ‚Äî no rAF gap
        const driftProgress = Math.max(0, Math.min(1, (endLeftPct + 5) / 110));
        const driftTimeMs = driftProgress * 25000;
        const driftAnim = boat.getAnimations().find(a => a.animationName === 'boatDrift');
        if (driftAnim) driftAnim.currentTime = driftTimeMs;
      });
    }
  }

  initBoatDrag();
</script>

<script>
  // Copy command functionality
  document.querySelectorAll('.copy-command').forEach(container => {
    const btn = container.querySelector('.copy-btn');
    const command = container.dataset.command;

    btn?.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(command);

        // Show success state
        const copyIcon = btn.querySelector('.copy-icon');
        const checkIcon = btn.querySelector('.check-icon');
        const copyText = btn.querySelector('.copy-text');

        copyIcon?.classList.add('hidden');
        checkIcon?.classList.remove('hidden');
        if (copyText) copyText.textContent = 'Copied!';

        // Reset after 2 seconds
        setTimeout(() => {
          copyIcon?.classList.remove('hidden');
          checkIcon?.classList.add('hidden');
          if (copyText) copyText.textContent = 'Copy';
        }, 2000);
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  });
</script>

