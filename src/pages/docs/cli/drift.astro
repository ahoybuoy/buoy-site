---
import DocsLayout from '../../../layouts/DocsLayout.astro'
import DocTerminal from '../../../components/DocTerminal.astro'
import Flags from '../../../components/Flags.astro'
import CodeBlock from '../../../components/CodeBlock.astro'
---

<DocsLayout title="buoy drift" description="Detect, analyze, and fix design drift">
  <h1>buoy drift</h1>

  <p>
    Detect design drift in your codebase. Scan for issues, inspect each drift signal,
    apply fixes, and manage ignore rules for intentional exceptions.
  </p>

  <h2>Usage</h2>

  <DocTerminal command="buoy drift <command> [options]" />

  <h2>Commands</h2>

  <Flags items={[
    { name: "scan", description: "Scan your codebase for design system usage and drift signals" },
    { name: "check", description: "Show detailed drift signals with severity and type" },
    { name: "fix", description: "Suggest and apply fixes for drift issues" },
    { name: "ignore", description: "Ignore specific drift signals by file, type, component, or value" },
  ]} />

  <!-- ─────────────────────────────────────────── -->
  <h2 id="scan">buoy drift scan</h2>

  <p>
    Scan your codebase for design system usage. Zero-config auto-detection finds
    components, tokens, and patterns. Results are cached for fast repeat runs.
  </p>

  <DocTerminal command="buoy drift scan [options]" />

  <h3>Options</h3>

  <Flags items={[
    { name: "-s, --source <path>", description: "Source directory to scan (default: auto-detected)" },
    { name: "--json", description: "Output as JSON for scripting" },
    { name: "-v, --verbose", description: "Show detailed scan progress and per-file results" },
    { name: "--no-persist", description: "Don't save results to scan history" },
    { name: "--no-cache", description: "Bypass cache and force a full re-scan" },
    { name: "--clear-cache", description: "Clear the scan cache before running" },
  ]} />

  <h3>Examples</h3>

  <h4>Basic scan</h4>

  <DocTerminal command="buoy drift scan" lines={[
    { text: "" },
    { text: "Scanning project..." },
    { text: "" },
    { text: "Auto-detected:", type: "info" },
    { text: "  Framework: React" },
    { text: "  Styling: Tailwind CSS" },
    { text: "  Source: src/" },
    { text: "" },
    { text: "Scanned 84 files in 1.2s" },
    { text: "" },
    { text: "Results" },
    { text: "───────" },
    { text: "Components: 42 detected" },
    { text: "Tokens: 67 resolved" },
    { text: "Drift signals: 23", type: "warning" },
    { text: "Health score: 72/100", type: "success" },
    { text: "" },
    { text: "Cache: saved to .buoy/cache.json (next scan will be faster)", type: "muted" },
  ]} />

  <h4>Scan a specific directory</h4>

  <DocTerminal command="buoy drift scan -s packages/ui/src" lines={[
    { text: "" },
    { text: "Scanning packages/ui/src..." },
    { text: "" },
    { text: "Scanned 28 files in 0.6s" },
    { text: "" },
    { text: "Results" },
    { text: "───────" },
    { text: "Components: 15 detected" },
    { text: "Tokens: 34 resolved" },
    { text: "Drift signals: 8", type: "warning" },
    { text: "Health score: 81/100", type: "success" },
  ]} />

  <h4>Verbose output</h4>

  <DocTerminal command="buoy drift scan -v" lines={[
    { text: "" },
    { text: "Scanning project..." },
    { text: "" },
    { text: "Auto-detected:", type: "info" },
    { text: "  Framework: React" },
    { text: "  Styling: Tailwind CSS" },
    { text: "  Source: src/" },
    { text: "" },
    { text: "  ✓ src/components/Button.tsx      8 tokens, 0 drift", type: "success" },
    { text: "  ✓ src/components/Card.tsx        6 tokens, 2 drift", type: "warning" },
    { text: "  ✓ src/components/Badge.tsx       4 tokens, 1 drift", type: "warning" },
    { text: "  ✓ src/components/Modal.tsx       5 tokens, 0 drift", type: "success" },
    { text: "  ...80 more files", type: "muted" },
    { text: "" },
    { text: "Scanned 84 files in 1.4s" },
    { text: "" },
    { text: "Results" },
    { text: "───────" },
    { text: "Components: 42 detected" },
    { text: "Tokens: 67 resolved" },
    { text: "Drift signals: 23", type: "warning" },
    { text: "Health score: 72/100", type: "success" },
  ]} />

  <h3>Auto-detection</h3>

  <p>
    <code>buoy drift scan</code> works with zero configuration. It auto-detects your framework,
    styling approach, and source directory. Supported frameworks include React, Vue,
    Svelte, Angular, and vanilla HTML/CSS.
  </p>

  <!-- ─────────────────────────────────────────── -->
  <h2 id="check">buoy drift check</h2>

  <p>
    Show detailed information about each instance where code diverges from your design system.
    Use in CI pipelines for automated drift detection.
  </p>

  <DocTerminal command="buoy drift check [options]" />

  <h3>Options</h3>

  <Flags items={[
    { name: "--type <type>", description: "Filter by drift type (color, spacing, typography)" },
    { name: "--severity <level>", description: "Filter by severity (high, medium, low)" },
    { name: "--file <path>", description: "Check specific file only" },
    { name: "--json", description: "Output as JSON for scripting" },
    { name: "--include <glob>", description: "Include additional file patterns" },
    { name: "--exclude <glob>", description: "Exclude file patterns" },
  ]} />

  <h3>Example Output</h3>

  <DocTerminal command="buoy drift check" lines={[
    { text: "" },
    { text: "Drift Analysis" },
    { text: "──────────────" },
    { text: "" },
    { text: "~ Hardcoded Value", type: "warning" },
    { text: "  Component: Card" },
    { text: "  Location:  src/components/Card.tsx:14" },
    { text: "  Issue:     backgroundColor: #f9fafb (not a design token)" },
    { text: "" },
    { text: "  Actions:" },
    { text: "    1. Replace with design token" },
    { text: "    2. Example: var(--color-gray-50) or theme.colors.gray[50]", type: "info" },
    { text: "" },
    { text: "~ Close Match (Possible Typo)", type: "warning" },
    { text: "  Component: Button" },
    { text: "  Location:  src/components/Button.tsx:28" },
    { text: "  Issue:     color: #3b83f6 (close to #3b82f6)" },
    { text: "" },
    { text: "  Actions:" },
    { text: "    1. Verify if this is intentional" },
    { text: "    2. If typo, replace with #3b82f6", type: "info" },
    { text: "" },
    { text: "──────────────────────────────────────" },
    { text: "Total: 47 drift signals found" },
    { text: "  High severity: 12" },
    { text: "  Medium severity: 23" },
    { text: "  Low severity: 12" },
  ]} />

  <h3>Filtering Examples</h3>

  <CodeBlock code={`# Only color issues
buoy drift check --type color

# Only high severity
buoy drift check --severity high

# Specific file
buoy drift check --file src/components/Card.tsx

# Combine filters
buoy drift check --type spacing --severity high`} language="bash" />

  <h3>What It Scans</h3>

  <Flags items={[
    { name: "React", description: "Components, props, inline styles" },
    { name: "Vue", description: "Components, scoped styles" },
    { name: "Svelte", description: "Components, style blocks" },
    { name: "Angular", description: "Components, stylesheets" },
    { name: "Tailwind", description: "Config tokens, arbitrary values" },
    { name: "CSS/SCSS", description: "Custom properties, values" },
  ]} />

  <!-- ─────────────────────────────────────────── -->
  <h2 id="fix">buoy drift fix</h2>

  <p>
    Automatically fix design drift issues in your codebase. Replaces hardcoded
    values with design tokens and applies other safe transformations.
  </p>

  <DocTerminal command="buoy drift fix [options]" />

  <h3>Options</h3>

  <Flags items={[
    { name: "--apply", description: "Apply fixes to source files" },
    { name: "--dry-run", description: "Show detailed diff without applying changes" },
    { name: "-c, --confidence <level>", description: 'Minimum confidence level: exact, high, medium, low', default: "high" },
    { name: "-t, --type <types>", description: "Fix types to include (comma-separated: hardcoded-color, hardcoded-spacing)" },
    { name: "-f, --file <patterns>", description: "File glob patterns to include (comma-separated)" },
    { name: "--exclude <patterns>", description: "File glob patterns to exclude (comma-separated)" },
    { name: "--backup", description: "Create .bak backup files before modifying" },
    { name: "--json", description: "Output as JSON" },
    { name: "--force", description: "Skip safety checks" },
  ]} />

  <h3>Examples</h3>

  <h4>Preview fixes (dry run)</h4>

  <DocTerminal command="buoy drift fix --dry-run" lines={[
    { text: "" },
    { text: "Found 18 auto-fixable issues", type: "info" },
    { text: "" },
    { text: "Button.tsx:12" },
    { text: "- color: '#3b82f6'", type: "warning" },
    { text: "+ color: 'var(--color-primary)'", type: "success" },
    { text: "" },
    { text: "Card.tsx:8" },
    { text: "- padding: '16px'", type: "warning" },
    { text: "+ padding: 'var(--spacing-md)'", type: "success" },
    { text: "" },
    { text: "Run with --apply to apply these changes." },
  ]} />

  <h4>Apply fixes</h4>

  <DocTerminal command="buoy drift fix --apply" lines={[
    { text: "" },
    { text: "Applying 18 fixes..." },
    { text: "" },
    { text: "✓ Button.tsx: 3 fixes applied", type: "success" },
    { text: "✓ Card.tsx: 2 fixes applied", type: "success" },
    { text: "✓ Modal.tsx: 5 fixes applied", type: "success" },
    { text: "... and 8 more files" },
    { text: "" },
    { text: "18 issues fixed. 5 need manual review.", type: "success" },
  ]} />

  <h4>Fix only color issues</h4>

  <DocTerminal command="buoy drift fix --apply --type hardcoded-color" />

  <h4>Fix specific files</h4>

  <DocTerminal command='buoy drift fix --apply --file "src/components/**/*.tsx"' />

  <h3>Confidence Levels</h3>

  <p>Each fix suggestion includes a confidence score indicating how safe it is to apply:</p>

  <Flags items={[
    { name: "exact", description: "100% — Value exactly matches a design token — safest to auto-apply" },
    { name: "high", description: "95-99% — Very close match, safe to auto-apply" },
    { name: "medium", description: "70-94% — Close match, review recommended" },
    { name: "low", description: "<70% — Ambiguous, manual review required" },
  ]} />

  <p>By default, <code>--apply</code> only applies <code>high</code> and <code>exact</code> confidence fixes.</p>

  <!-- ─────────────────────────────────────────── -->
  <h2 id="ignore">buoy drift ignore</h2>

  <p>
    Ignore specific drift signals so they don't appear in checks or affect your health score.
    More targeted than baselines — filter by file path, drift type, component name, or specific value.
  </p>

  <DocTerminal command="buoy drift ignore <command> [options]" />

  <h3>Commands</h3>

  <Flags items={[
    { name: "all", description: "Ignore all current drift signals" },
    { name: "add", description: "Add current drift signals to the ignore list" },
    { name: "show", description: "View all ignored signals and their filters" },
    { name: "clear", description: "Remove the ignore list entirely" },
  ]} />

  <h3>Options</h3>

  <p>These flags work with <code>all</code> and <code>add</code> to target specific signals:</p>

  <Flags items={[
    { name: '--file <glob>', description: 'Ignore drift in matching files or folders (e.g. "src/legacy/**")' },
    { name: '--type <type>', description: 'Ignore a specific drift type (e.g. hardcoded-color)' },
    { name: '--component <name>', description: 'Ignore drift from a specific component (e.g. "LegacyCard")' },
    { name: '--value <value>', description: 'Ignore a specific hardcoded value (e.g. "#ff0000")' },
  ]} />

  <h3>Examples</h3>

  <h4>Ignore all drift in legacy code</h4>

  <DocTerminal command='buoy drift ignore add --file "src/legacy/**"' lines={[
    { text: "" },
    { text: 'Added ignore rule: files matching "src/legacy/**"', type: "success" },
    { text: "14 drift signals will be hidden." },
  ]} />

  <h4>Ignore a specific drift type</h4>

  <DocTerminal command="buoy drift ignore add --type hardcoded-color" lines={[
    { text: "" },
    { text: "Added ignore rule: type hardcoded-color", type: "success" },
    { text: "9 drift signals will be hidden." },
  ]} />

  <h4>Ignore drift from a single component</h4>

  <DocTerminal command='buoy drift ignore add --component "LegacyCard"' lines={[
    { text: "" },
    { text: 'Added ignore rule: component "LegacyCard"', type: "success" },
    { text: "3 drift signals will be hidden." },
  ]} />

  <h4>Ignore a specific value</h4>

  <DocTerminal command='buoy drift ignore add --value "#ff0000"' lines={[
    { text: "" },
    { text: 'Added ignore rule: value "#ff0000"', type: "success" },
    { text: "2 drift signals will be hidden." },
  ]} />

  <h4>Combine filters</h4>

  <CodeBlock code={`# Ignore hardcoded colors in legacy files
buoy drift ignore add --file "src/legacy/**" --type hardcoded-color

# Ignore a specific value in a specific component
buoy drift ignore add --component "OldButton" --value "#333"`} language="bash" />

  <h4>View ignored signals</h4>

  <DocTerminal command="buoy drift ignore show" lines={[
    { text: "" },
    { text: "Ignore Rules" },
    { text: "────────────" },
    { text: "" },
    { text: '1. files matching "src/legacy/**"          (14 signals)' },
    { text: "2. type: hardcoded-color                   (9 signals)" },
    { text: '3. component: "LegacyCard"                 (3 signals)' },
    { text: "" },
    { text: "Total: 26 signals ignored", type: "muted" },
  ]} />

  <h4>Clear all ignore rules</h4>

  <DocTerminal command="buoy drift ignore clear" lines={[
    { text: "" },
    { text: "Ignore list removed. All drift signals will be shown.", type: "success" },
  ]} />

  <!-- ─────────────────────────────────────────── -->
  <h2 id="severity-pipeline">Severity Pipeline</h2>

  <p>
    When <code>buoy drift check</code> runs, severity rules from <code>.buoy.yaml</code> are applied
    in a fixed order before results are displayed:
  </p>

  <Flags items={[
    { name: "1. Promote", description: "Conditional severity upgrades. Matches drift by type, file, component, token, or value and elevates severity (e.g. warning → critical)." },
    { name: "2. Enforce", description: "Unconditional critical. Overrides any promote result. If enforce matches, the drift is critical — no negotiation." },
    { name: "3. Ignore", description: "The escape hatch. Ignored drift is excluded entirely, even if promoted or enforced." },
  ]} />

  <p>
    Configure these in your <code>.buoy.yaml</code> under <code>drift.promote</code>, <code>drift.enforce</code>,
    and <code>drift.ignore</code>. See <a href="/docs/configuration">Configuration</a> for full details.
  </p>

  <h3>Health gate</h3>

  <p>
    When <code>health.failBelow</code> is configured, <code>buoy drift check</code> also exits with code 1
    if the health score drops below the threshold. The <code>--json</code> output includes a health object:
  </p>

  <CodeBlock code={`{
  "drifts": [...],
  "health": {
    "score": 68,
    "threshold": 70,
    "passed": false
  }
}`} language="json" />

  <!-- ─────────────────────────────────────────── -->
  <h2>Drift Types</h2>

  <Flags items={[
    { name: "hardcoded-value", description: "Raw values instead of design tokens" },
    { name: "close-match", description: "Values near tokens (likely typos)" },
    { name: "naming-inconsistency", description: "Component names that don't follow conventions" },
    { name: "deprecated-pattern", description: "Usage of deprecated design patterns" },
  ]} />

  <!-- ─────────────────────────────────────────── -->
  <h2>Related</h2>

  <ul>
    <li><a href="/docs/cli/show">buoy show</a> — View drift signals, health, and history</li>
    <li><a href="/docs/cli/dock">buoy dock</a> — Setup tokens, graph, and project config</li>
  </ul>
</DocsLayout>
