---
import DocsLayout from '../../../layouts/DocsLayout.astro'
import DocTerminal from '../../../components/DocTerminal.astro'
import Flags from '../../../components/Flags.astro'
import CodeBlock from '../../../components/CodeBlock.astro'
import LeadMagnetCallout from '../../../components/LeadMagnetCallout.astro'
---

<DocsLayout title="buoy build" description="Generate tokens and build the design system knowledge graph">
  <h1>buoy build</h1>

  <p>
    Generate design tokens, import external token files, compare codebase values against tokens,
    and build a knowledge graph of your design system.
  </p>

  <h2>Usage</h2>

  <DocTerminal command="buoy build <command> [options]" />

  <h2>Commands</h2>

  <Flags items={[
    { name: "tokens", description: "Generate design tokens from your codebase" },
    { name: "tokens compare <file>", description: "Compare codebase values against a design tokens file" },
    { name: "tokens import <file>", description: "Import design tokens from external sources" },
    { name: "graph", description: "Build and query the design system knowledge graph" },
  ]} />

  <!-- ─────────────────────────────────────────── -->
  <h2 id="tokens">buoy build tokens</h2>

  <p>
    Generate design tokens from values detected in your codebase. Outputs to
    CSS variables, JSON, Tailwind config, or AI-friendly context.
  </p>

  <DocTerminal command="buoy build tokens [options]" />

  <h3>Options</h3>

  <Flags items={[
    { name: "-o, --output <path>", description: "Output file path (auto-detected if not specified)" },
    { name: "--format <format>", description: "Output format: css, json, tailwind, ai-context (auto-detected)" },
    { name: "--dry-run", description: "Preview without writing files" },
    { name: "--prefix <prefix>", description: 'Prefix for CSS custom properties (e.g., "ds-")' },
  ]} />

  <h3>Examples</h3>

  <h4>Generate CSS variables</h4>

  <DocTerminal command="buoy build tokens --format css" lines={[
    { text: "" },
    { text: ":root {" },
    { text: "  --color-primary: #3b82f6;" },
    { text: "  --color-secondary: #64748b;" },
    { text: "  --spacing-sm: 8px;" },
    { text: "  --spacing-md: 16px;" },
    { text: "  --spacing-lg: 24px;" },
    { text: "}" },
  ]} />

  <h4>Generate Tailwind extension</h4>

  <DocTerminal command="buoy build tokens --format tailwind -o tailwind.tokens.js" />

  <h4>Generate AI context</h4>

  <DocTerminal command="buoy build tokens --format ai-context" lines={[
    { text: "" },
    { text: "Use for AI agents to understand available tokens with usage context." },
  ]} />

  <h3>Output Formats</h3>

  <ul>
    <li><strong>css</strong> - CSS custom properties (:root variables)</li>
    <li><strong>json</strong> - Standard JSON token format</li>
    <li><strong>tailwind</strong> - Tailwind CSS theme extension</li>
    <li><strong>ai-context</strong> - Markdown with token intent and usage</li>
  </ul>

  <LeadMagnetCallout
    leadMagnet="token-migration"
    headline="Planning a design token migration?"
    subhead="Step-by-step playbook for migrating from hardcoded values to design tokens. Avoid the common pitfalls."
    buttonText="Get the Playbook"
    class="my-8"
  />

  <!-- ─────────────────────────────────────────── -->
  <h3>Compare token sources</h3>

  <p>
    Compare your codebase values against a design tokens file. Identifies which values in
    your code don't match any defined tokens.
  </p>

  <DocTerminal command="buoy build tokens compare <tokens-file> [options]" />

  <Flags items={[
    { name: "<tokens-file>", description: "Path to design tokens file (JSON, CSS, or SCSS)", required: true },
    { name: "--json", description: "Output as JSON for scripting" },
    { name: "-v, --verbose", description: "Show per-file breakdown and usage frequency details" },
    { name: "--strict", description: "Fail if any unmatched values found" },
  ]} />

  <h4>Supported Token Formats</h4>

  <p><strong>Design Tokens JSON (W3C format)</strong></p>

  <CodeBlock code={`{
  "color": {
    "primary": { "$value": "#3b82f6" },
    "secondary": { "$value": "#64748b" }
  },
  "spacing": {
    "sm": { "$value": "8px" },
    "md": { "$value": "16px" }
  }
}`} language="json" />

  <p><strong>Tokens Studio / Figma Export</strong></p>

  <CodeBlock code={`{
  "colors": {
    "blue-500": "#3b82f6",
    "gray-500": "#64748b"
  }
}`} language="json" />

  <p><strong>CSS Custom Properties</strong></p>

  <CodeBlock code={`:root {
  --color-primary: #3b82f6;
  --spacing-md: 16px;
}`} language="css" />

  <h4>Example Output</h4>

  <DocTerminal command="buoy build tokens compare design-tokens.json" lines={[
    { text: "" },
    { text: "Comparing against design-tokens.json..." },
    { text: "" },
    { text: "Token Coverage: 87%" },
    { text: "───────────────────" },
    { text: "" },
    { text: "Colors (78% coverage)" },
    { text: "  ✓ 18 values match tokens", type: "success" },
    { text: "  ✗ 5 values not in tokens:", type: "warning" },
    { text: "      #f9fafb (used 3 times in 2 files)" },
    { text: "      #374151 (used 2 times in 1 file)" },
    { text: "      #3b83f6 (used 1 time) ← typo? close to #3b82f6", type: "warning" },
    { text: "" },
    { text: "Spacing (86% coverage)" },
    { text: "  ✓ 12 values match tokens", type: "success" },
    { text: "  ✗ 2 values not in tokens:", type: "warning" },
    { text: "      15px (used 4 times in 3 files) ← close to 16px" },
    { text: "      13px (used 1 time)" },
    { text: "" },
    { text: "Typography (100% coverage)" },
    { text: "  ✓ 8 values match tokens", type: "success" },
    { text: "" },
    { text: "Summary" },
    { text: "───────" },
    { text: "Token coverage: 87%" },
    { text: "Unmatched values: 7" },
    { text: "Close matches (possible typos): 2", type: "warning" },
    { text: "Most frequent unmatched: #f9fafb (3 uses)" },
  ]} />

  <!-- ─────────────────────────────────────────── -->
  <h3>Import tokens</h3>

  <p>
    Import design tokens from external files. Supports JSON (DTCG, Tokens Studio,
    Style Dictionary) and CSS formats.
  </p>

  <DocTerminal command="buoy build tokens import <file> [options]" />

  <Flags items={[
    { name: "file", description: "Token file to import (JSON, CSS)", required: true },
    { name: "-o, --output <path>", description: "Output file path", default: "design-tokens.css" },
    { name: "-f, --format <format>", description: 'Output format: css, json, scss', default: "css" },
    { name: "--dry-run", description: "Preview import without writing files" },
  ]} />

  <h4>Import from Tokens Studio export</h4>

  <DocTerminal command="buoy build tokens import tokens-studio-export.json" lines={[
    { text: "" },
    { text: "Importing tokens..." },
    { text: "" },
    { text: "Found 67 tokens:", type: "info" },
    { text: "  - 24 colors" },
    { text: "  - 12 spacing" },
    { text: "  - 8 typography" },
    { text: "  - 23 other" },
    { text: "" },
    { text: "✓ Created design-tokens.css", type: "success" },
  ]} />

  <h4>Import to SCSS</h4>

  <DocTerminal command="buoy build tokens import tokens.json --format scss -o _tokens.scss" lines={[
    { text: "" },
    { text: "✓ Created _tokens.scss", type: "success" },
  ]} />

  <h4>Supported Formats</h4>

  <p><strong>Input:</strong> DTCG, Tokens Studio, Style Dictionary, CSS custom properties</p>
  <p><strong>Output:</strong> CSS custom properties, JSON, SCSS variables</p>

  <!-- ─────────────────────────────────────────── -->
  <h2 id="graph">buoy build graph</h2>

  <p>
    Build and query a knowledge graph of your design system. Understand
    relationships between components, tokens, and patterns.
  </p>

  <DocTerminal command="buoy build graph <command> [options]" />

  <h3>Commands</h3>

  <Flags items={[
    { name: "build", description: "Build the knowledge graph from the codebase (persists to .buoy/graph.json)" },
    { name: "learn", description: "Analyze drift history for repeat patterns and learnings" },
    { name: 'query <question>', description: "Query the knowledge graph" },
    { name: "export", description: "Export the graph for visualization" },
    { name: "stats", description: "Show graph statistics" },
  ]} />

  <h3>Options</h3>

  <Flags items={[
    { name: "--incremental", description: "Only rebuild nodes for changed files (faster rebuilds)" },
    { name: "--json", description: "Output as JSON" },
  ]} />

  <h3>Examples</h3>

  <h4>Build the graph</h4>

  <DocTerminal command="buoy build graph build" lines={[
    { text: "" },
    { text: "Building knowledge graph..." },
    { text: "" },
    { text: "Nodes: 156", type: "info" },
    { text: "  - 42 components" },
    { text: "  - 67 tokens" },
    { text: "  - 47 patterns" },
    { text: "" },
    { text: "Edges: 312 relationships" },
    { text: "" },
    { text: "Graph saved to .buoy/graph.json", type: "success" },
  ]} />

  <h4>Incremental rebuild</h4>

  <DocTerminal command="buoy build graph build --incremental" lines={[
    { text: "" },
    { text: "Rebuilding knowledge graph (incremental)..." },
    { text: "" },
    { text: "Changed files: 3" },
    { text: "  Updated: Button.tsx, Card.tsx, Badge.tsx" },
    { text: "" },
    { text: "Nodes: 156 (3 updated)", type: "info" },
    { text: "Edges: 314 relationships (+2)" },
    { text: "" },
    { text: "Graph saved to .buoy/graph.json", type: "success" },
  ]} />

  <h4>Query the graph</h4>

  <DocTerminal command='buoy build graph query "What components use the primary color?"' lines={[
    { text: "" },
    { text: "Components using --color-primary:" },
    { text: "  - Button (3 usages)" },
    { text: "  - Link (2 usages)" },
    { text: "  - Badge (1 usage)" },
    { text: "  - Tab (1 usage)" },
  ]} />

  <h4>Export for visualization</h4>

  <DocTerminal command="buoy build graph export --format dot -o graph.dot" lines={[
    { text: "" },
    { text: "Exported to graph.dot", type: "success" },
    { text: "Open with Graphviz or paste into https://dreampuf.github.io/GraphvizOnline/" },
  ]} />

  <h4>View statistics</h4>

  <DocTerminal command="buoy build graph stats" lines={[
    { text: "" },
    { text: "Knowledge Graph Statistics" },
    { text: "──────────────────────────" },
    { text: "Components: 42" },
    { text: "Tokens: 67" },
    { text: "Patterns: 47" },
    { text: "Relationships: 312" },
    { text: "" },
    { text: "Most connected:" },
    { text: "  - Button (23 relationships)" },
    { text: "  - Card (18 relationships)" },
    { text: "  - Typography (15 relationships)" },
  ]} />

  <!-- ─────────────────────────────────────────── -->
  <h3>Learn from drift history</h3>

  <p>
    Analyze your drift history to surface repeat patterns. Shows which mistakes you
    keep making so you can address the root cause, not just individual instances.
  </p>

  <DocTerminal command="buoy build graph learn [options]" />

  <Flags items={[
    { name: "-n, --limit <number>", description: "Number of scans to analyze", default: "10" },
    { name: "--threshold <number>", description: "Minimum occurrences to show", default: "2" },
    { name: "--json", description: "Output result as JSON" },
  ]} />

  <h4>Example Output</h4>

  <DocTerminal command="buoy build graph learn" lines={[
    { text: "" },
    { text: "  Your Repeat Mistakes" },
    { text: "" },
    { text: "● Hardcoded Value in Button (5x)", type: "warning" },
    { text: "    Files: src/Button.tsx, src/IconButton.tsx, src/LinkButton.tsx" },
    { text: "    Fix: Use var(--color-primary) instead", type: "info" },
    { text: "" },
    { text: "● Arbitrary Spacing in Card (3x)", type: "warning" },
    { text: "    Files: src/Card.tsx, src/CardHeader.tsx" },
    { text: "    Fix: Use spacing.4 instead", type: "info" },
    { text: "" },
    { text: "● Naming Inconsistency in Modal (2x)", type: "warning" },
    { text: "    Files: src/Modal.tsx, src/Dialog.tsx" },
    { text: "    Fix: Use consistent naming pattern", type: "info" },
    { text: "" },
    { text: "Key Insight" },
    { text: "────────────────────────────────────" },
    { text: "Your biggest issue is Hardcoded Value in Button (5x)" },
    { text: "" },
    { text: "Analyzed 10 scans, 47 total drifts", type: "muted" },
    { text: "Found 3 repeat patterns", type: "muted" },
  ]} />

  <h4>How It Helps</h4>

  <ul>
    <li><strong>Systemic issues</strong> — Same mistake across multiple files</li>
    <li><strong>Component hotspots</strong> — Which components drift most</li>
    <li><strong>Habit patterns</strong> — Types of drift you repeatedly introduce</li>
  </ul>

  <p>
    <code>buoy build graph learn</code> requires scan history. Run <code>buoy drift scan</code> multiple
    times to build up data. Each scan is stored locally and used for pattern analysis.
  </p>

  <!-- ─────────────────────────────────────────── -->
  <h2>Related</h2>

  <ul>
    <li><a href="/docs/cli/show">buoy show</a> — View components, tokens, and health</li>
    <li><a href="/docs/cli/drift">buoy drift</a> — Detect and fix design drift</li>
  </ul>
</DocsLayout>
