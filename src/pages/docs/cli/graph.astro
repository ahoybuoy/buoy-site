---
import DocsLayout from '../../../layouts/DocsLayout.astro'
---

<DocsLayout title="buoy graph" description="Build and query the design system knowledge graph">
  <h1>buoy graph</h1>

  <p>
    Build and query a knowledge graph of your design system. Understand
    relationships between components, tokens, and patterns.
  </p>

  <h2>Usage</h2>

  <pre><code>buoy graph &lt;command&gt; [options]</code></pre>

  <h2>Commands</h2>

  <table>
    <thead>
      <tr>
        <th>Command</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>build</code></td>
        <td>Build the knowledge graph from the codebase (persists to <code>.buoy/graph.json</code>)</td>
      </tr>
      <tr>
        <td><code>query &lt;question&gt;</code></td>
        <td>Query the knowledge graph</td>
      </tr>
      <tr>
        <td><code>export</code></td>
        <td>Export the graph for visualization</td>
      </tr>
      <tr>
        <td><code>stats</code></td>
        <td>Show graph statistics</td>
      </tr>
    </tbody>
  </table>

  <h2>Options</h2>

  <table>
    <thead>
      <tr>
        <th>Option</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>--incremental</code></td>
        <td>Only rebuild nodes for changed files (faster rebuilds)</td>
      </tr>
      <tr>
        <td><code>--json</code></td>
        <td>Output as JSON</td>
      </tr>
    </tbody>
  </table>

  <h2>Examples</h2>

  <h3>Build the graph</h3>

  <pre><code>$ buoy graph build

Building knowledge graph...

Nodes: 156
  - 42 components
  - 67 tokens
  - 47 patterns

Edges: 312 relationships

Graph saved to .buoy/graph.json</code></pre>

  <h3>Incremental rebuild</h3>

  <pre><code>$ buoy graph build --incremental

Rebuilding knowledge graph (incremental)...

Changed files: 3
  Updated: Button.tsx, Card.tsx, Badge.tsx

Nodes: 156 (3 updated)
Edges: 314 relationships (+2)

Graph saved to .buoy/graph.json</code></pre>

  <h3>Query the graph</h3>

  <pre><code>$ buoy graph query "What components use the primary color?"

Components using --color-primary:
  - Button (3 usages)
  - Link (2 usages)
  - Badge (1 usage)
  - Tab (1 usage)</code></pre>

  <h3>Most used tokens</h3>

  <pre><code>$ buoy graph query "most used"

Most Used Tokens
────────────────
Token                    Usages   Components
--spacing-md             23       12
--font-size-base         18       9
--color-primary          14       4
--border-radius-md       11       7
--color-secondary        9        3</code></pre>

  <h3>What uses a specific token</h3>

  <pre><code>$ buoy graph query "what uses --spacing-md"

Token: --spacing-md (23 usages)
───────────────────────────────
Component        File                       Line
Button           src/components/Button.tsx   8, 14
Card             src/components/Card.tsx     5, 12, 19
Modal            src/components/Modal.tsx    11
Layout           src/Layout.tsx              3, 7, 22
...8 more components</code></pre>

  <h3>Export for visualization</h3>

  <pre><code>$ buoy graph export --format dot -o graph.dot

Exported to graph.dot
Open with Graphviz or paste into https://dreampuf.github.io/GraphvizOnline/</code></pre>

  <h3>View statistics</h3>

  <pre><code>$ buoy graph stats

Knowledge Graph Statistics
──────────────────────────
Components: 42
Tokens: 67
Patterns: 47
Relationships: 312

Most connected:
  - Button (23 relationships)
  - Card (18 relationships)
  - Typography (15 relationships)</code></pre>

  <h2>Related</h2>

  <ul>
    <li><a href="/docs/cli/audit">buoy audit</a> - Health scoring</li>
  </ul>
</DocsLayout>
