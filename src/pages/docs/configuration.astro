---
import DocsLayout from '../../layouts/DocsLayout.astro'
---

<DocsLayout title="Configuration" description="Configure Buoy for your project">
  <h1>Configuration</h1>

  <p>
    Buoy uses a <code>.buoy.yaml</code> file in your project root. Most settings are
    auto-detected, but you can customize everything.
  </p>

  <h2>Quick Start</h2>

  <pre><code>npx ahoybuoy dock config</code></pre>

  <p>This generates a config based on your detected frameworks.</p>

  <h2>Config File</h2>

  <pre><code># .buoy.yaml

# Source scanning
sources:
  react:
    enabled: true
  vue:
    enabled: false
  svelte:
    enabled: false
  angular:
    enabled: false
  tailwind:
    enabled: true

# File patterns
include:
  - "src/**/*.&#123;tsx,jsx,vue,svelte,css,scss&#125;"
exclude:
  - "node_modules"
  - "dist"
  - "build"
  - "**/*.test.*"

# Design tokens reference
tokens:
  file: "design-tokens.json"   # Local file
  # OR
  figma:
    fileId: "your-figma-file-id"
    accessToken: $FIGMA_TOKEN

# Health thresholds
thresholds:
  minScore: 70                  # Minimum passing score
  maxHardcoded: 10              # Max allowed hardcoded values

# Severity rules
drift:
  promote:
    - type: hardcoded-color
      file: "src/checkout/**"
      severity: warning
      to: critical
      reason: "Checkout must use tokens"
  enforce:
    - type: close-match
      reason: "Typos are always critical"

# Health gate
health:
  failBelow: 70                   # Exit code 1 below this score

# Output settings
output:
  format: table                 # table | json | markdown</code></pre>

  <h2>Source Options</h2>

  <h3>React</h3>

  <pre><code>sources:
  react:
    enabled: true
    include:
      - "src/**/*.tsx"
      - "src/**/*.jsx"
    extractInlineStyles: true
    extractStyledComponents: true</code></pre>

  <h3>Tailwind</h3>

  <pre><code>sources:
  tailwind:
    enabled: true
    config: "tailwind.config.js"      # Path to config
    detectArbitrary: true             # Flag arbitrary values like [#fff]</code></pre>

  <h3>Vue / Svelte / Angular</h3>

  <pre><code>sources:
  vue:
    enabled: true
    include:
      - "src/**/*.vue"
    extractScopedStyles: true
  svelte:
    enabled: true
    include:
      - "src/**/*.svelte"
  angular:
    enabled: true
    include:
      - "src/**/*.component.ts"</code></pre>

  <h2>Token Configuration</h2>

  <h3>Local Token File</h3>

  <pre><code>tokens:
  file: "design-tokens.json"</code></pre>

  <p>Supports JSON (W3C format), CSS, and SCSS files.</p>

  <h3>Figma Integration</h3>

  <pre><code>tokens:
  figma:
    fileId: "abc123xyz"
    accessToken: $FIGMA_TOKEN
    # Optional: specific pages/frames
    pages:
      - "Design Tokens"</code></pre>

  <p>See <a href="/docs/cli/dock#tokens">Token Configuration</a> for setup.</p>

  <h2>Threshold Configuration</h2>

  <pre><code>thresholds:
  minScore: 70               # CI fails below this score
  maxHardcoded: 10           # Max hardcoded values allowed
  maxCloseMatches: 0         # Zero tolerance for typos</code></pre>

  <h2>Severity Rules: promote</h2>

  <p>
    Promote drift severity conditionally based on filters. When a drift signal matches a promote rule,
    its severity is elevated from one level to another.
  </p>

  <pre><code>drift:
  promote:
    - type: hardcoded-color
      file: "src/checkout/**"
      severity: warning
      to: critical
      reason: "Checkout UI must use design tokens"

    - file: "src/components/shared/**"
      severity: warning
      to: critical
      reason: "Shared components set the standard"</code></pre>

  <h3>Filter Fields</h3>

  <table>
    <thead>
      <tr>
        <th>Field</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>type</code></td>
        <td>string</td>
        <td>Drift type (e.g. <code>hardcoded-color</code>, <code>close-match</code>)</td>
      </tr>
      <tr>
        <td><code>severity</code></td>
        <td>string</td>
        <td>Current severity to match (<code>warning</code>, <code>info</code>)</td>
      </tr>
      <tr>
        <td><code>file</code></td>
        <td>glob</td>
        <td>File path pattern (e.g. <code>src/checkout/**</code>)</td>
      </tr>
      <tr>
        <td><code>component</code></td>
        <td>regex</td>
        <td>Component name pattern (e.g. <code>Legacy.*</code>)</td>
      </tr>
      <tr>
        <td><code>token</code></td>
        <td>regex</td>
        <td>Token name pattern (e.g. <code>color-primary</code>)</td>
      </tr>
      <tr>
        <td><code>value</code></td>
        <td>regex</td>
        <td>Hardcoded value pattern (e.g. <code>#3b82f6</code>)</td>
      </tr>
      <tr>
        <td><code>to</code></td>
        <td>string</td>
        <td>Target severity (<code>critical</code>, <code>warning</code>)</td>
      </tr>
      <tr>
        <td><code>reason</code></td>
        <td>string</td>
        <td>Explanation shown in output</td>
      </tr>
    </tbody>
  </table>

  <p>Multiple fields in one rule combine with AND logic. Multiple rules use first-match-wins.</p>

  <h2>Severity Rules: enforce</h2>

  <p>
    Enforce rules set matching drift to critical unconditionally. Unlike promote, enforce rules have
    no <code>severity</code> filter and no <code>to</code> field — the result is always critical.
  </p>

  <pre><code>drift:
  enforce:
    - type: close-match
      reason: "Typos must be fixed before merge"

    - file: "packages/design-system/**"
      reason: "The design system must be clean"</code></pre>

  <p>
    Enforce uses the same filter fields as promote except <code>severity</code> and <code>to</code>.
    In the severity pipeline, enforce runs after promote and overrides it.
  </p>

  <h2>Health Gate</h2>

  <p>
    Set a minimum health score threshold. When <code>buoy drift check</code> runs, it exits with
    code 1 if the score drops below the configured value.
  </p>

  <pre><code>health:
  failBelow: 70    # Exit code 1 if health score &lt; 70</code></pre>

  <p>
    This is config-based — no CLI flags required. Pairs well with <code>--fail-on</code> for
    layered CI gating. The <code>--json</code> output includes a <code>health</code> object with
    <code>score</code>, <code>threshold</code>, and <code>passed</code> fields when configured.
  </p>

  <h2>Environment Variables</h2>

  <table>
    <thead>
      <tr>
        <th>Variable</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><code>FIGMA_TOKEN</code></td>
        <td>Figma API access token</td>
      </tr>
      <tr>
        <td><code>GITHUB_TOKEN</code></td>
        <td>GitHub token for PR comments</td>
      </tr>
      <tr>
        <td><code>BUOY_STRICT</code></td>
        <td>Enable strict mode (1 = enabled)</td>
      </tr>
    </tbody>
  </table>

  <h2>Ignoring Files</h2>

  <p>Add patterns to <code>exclude</code>:</p>

  <pre><code>exclude:
  - "node_modules"
  - "dist"
  - "build"
  - "**/*.test.*"
  - "**/*.stories.*"
  - "src/legacy/**"          # Ignore legacy code</code></pre>

  <h2>Inline Ignores</h2>

  <p>Ignore specific lines in your code:</p>

  <pre><code>// buoy-ignore-next-line
const specialColor = '#custom123';

/* buoy-ignore */
const legacyStyles = &#123;
  padding: '13px',
  color: '#abc123',
&#125;;</code></pre>

  <h2>Related</h2>

  <ul>
    <li><a href="/docs/cli/dock">buoy dock config</a> — Generate config automatically</li>
    <li><a href="/docs/cli/dock#tokens">buoy dock tokens import</a> — Import design tokens</li>
    <li><a href="/docs/integrations/github-actions">GitHub App</a> — CI configuration</li>
  </ul>
</DocsLayout>
